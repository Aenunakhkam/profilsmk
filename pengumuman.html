<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengumuman Penerimaan Siswa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Poppins', sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #007bff, #00bfff);
            color: white;
            padding: 40px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.2rem;
            margin-bottom: 0;
        }
        .running-text {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            overflow: hidden;
            white-space: nowrap;
        }
        .running-text marquee {
            font-size: 1rem;
            color: #FFD700;
            font-weight: bold;
        }
        .running-text i {
            margin-right: 10px;
            color: #FFD700;
        }
        .info-box {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .info-box i {
            margin-right: 10px;
            color: #ffc107;
            font-size: 1.5rem;
        }
        .info-box p {
            margin-bottom: 0;
            font-size: 1rem;
        }
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        .search-box input {
            flex: 1;
            border-radius: 5px;
            border: 1px solid #ced4da;
            padding: 10px;
        }
        .search-box button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .search-box button:hover {
            background-color: #0056b3;
        }
        .entries-box {
            margin-bottom: 20px;
        }
        .table {
            margin: 20px 0;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        .table thead th {
            background-color: #007bff;
            color: white;
            border: none;
        }
        .table tbody tr {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .table tbody tr:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .accepted {
            border-left: 5px solid #28a745;
        }
        .accepted .status {
            color: #28a745;
            font-weight: bold;
        }
        .rejected {
            border-left: 5px solid #dc3545;
        }
        .rejected .status {
            color: #dc3545;
            font-weight: bold;
        }
        .warning {
            color: #dc3545;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
        .footer {
            background-color: #007bff;
            color: white;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .footer a {
            color: white;
            margin: 0 10px;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        .footer a:hover {
            color: #ffc107;
        }
        .btn-print {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .btn-print:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Pengumuman Penerimaan Siswa</h1>
            <p>SMK Hasyim Asy'ari Bojong - Tahun Ajaran 2025/2026</p>
            <!-- Running Text -->
            <div class="running-text">
                <marquee behavior="scroll" direction="left">
                    <i class="fas fa-bullhorn"></i>Informasi Penting: Pengumuman hasil seleksi penerimaan murid baru tahun ajaran 2025/2026 segera dibuka. Silahkan cek nama kamu bisa cari di kolom pencarian,jika statusnya diterima segara cetak surat keterangan diterima untuk persyaratan daftar ulang, bagi namanya yang tidak tampil cek secara berkala kerana sistem berubah sewaktu - waktu!</i>
                </marquee>
            </div>
        </div>

        <!-- Kotak Informasi -->
        <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <p>Bagi calon siswa yang dinyatakan diterima, segera cetak kartu tanda terima dan gunakan untuk daftar ulang.</p>
        </div>

        <!-- Peringatan -->
        <div id="warningMessage" class="warning"></div>

        <!-- Filter dan Pencarian -->
        <div class="row">
            <div class="col-md-6 entries-box">
                <label for="entries">Show entries:</label>
                <select id="entries" class="form-select">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="all">All</option>
                </select>
            </div>
            <div class="col-md-6">
                <div class="search-box">
                    <input type="text" id="search" class="form-control" placeholder="Cari nama...">
                    <button id="searchButton"><i class="fas fa-search"></i> Cari</button>
                </div>
            </div>
        </div>

        <!-- Tabel -->
        <table class="table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Nama</th>
                    <th>Asal Sekolah</th>
                    <th>NISN</th>
                    <th>Tanggal Lahir</th>
                    <th>Jenis Kelamin</th>
                    <th>Nama Ibu</th>
                    <th>Status</th>
                    <th>Tanggal Pembukaan</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="announcementContainer"></tbody>
        </table>

        <!-- Footer -->
        <div class="footer">
            <p>Ikuti kami di:</p>
            <div>
                <a href="#" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="#" target="_blank"><i class="fab fa-youtube"></i></a>
            </div>
            <p class="mt-3">Â© 2025 SMK Hasyim Asy'ari Bojong. All rights reserved.</p>
        </div>
    </div>

    <script>
        const sheetId = '1gCgzVIUENgO__M5PQXtWbU4YM4Q-uKxR3QxAELAvGPE'; // Ganti dengan ID Google Sheet Anda
        const apiKey = 'AIzaSyD0onwYazef-vE8o1FmYUEe41PRL95ULMU'; // Ganti dengan API Key Anda
        const range = 'A:I'; // Mengambil semua baris dan kolom A sampai I

        let allData = []; // Menyimpan semua data untuk pencarian dan filter

        async function fetchData() {
            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
            const data = await response.json();
            allData = data.values.slice(1); // Simpan semua data kecuali header
            displayData(allData);
        }

        function displayData(data) {
            const container = document.getElementById('announcementContainer');
            const warningMessage = document.getElementById('warningMessage');
            const currentDate = new Date();
            let hasOpenDate = false;

            container.innerHTML = ''; // Kosongkan tabel sebelum menambahkan data baru

            data.forEach((row, index) => {
                const openDate = new Date(row[7]); // Tanggal pembukaan ada di kolom H (format YYYY-MM-DD HH:MM:SS)
                const formattedDate = openDate.toLocaleString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                if (openDate > currentDate) {
                    hasOpenDate = true;

                    // Hitung mundur
                    const timeDiff = openDate - currentDate;
                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                    warningMessage.innerHTML = `
                        <i class="fas fa-exclamation-circle"></i> 
                        Pengumuman akan dibuka pada: ${formattedDate}. 
                        Waktu tersisa: ${days} hari, ${hours} jam, ${minutes} menit, ${seconds} detik.
                    `;

                    // Update hitung mundur setiap detik
                    const countdownInterval = setInterval(() => {
                        const now = new Date();
                        const newTimeDiff = openDate - now;

                        if (newTimeDiff <= 0) {
                            clearInterval(countdownInterval);
                            warningMessage.innerHTML = '';
                            fetchData(); // Refresh data setelah pengumuman dibuka
                        } else {
                            const newDays = Math.floor(newTimeDiff / (1000 * 60 * 60 * 24));
                            const newHours = Math.floor((newTimeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            const newMinutes = Math.floor((newTimeDiff % (1000 * 60 * 60)) / (1000 * 60));
                            const newSeconds = Math.floor((newTimeDiff % (1000 * 60)) / 1000);

                            warningMessage.innerHTML = `
                                <i class="fas fa-exclamation-circle"></i> 
                                Pengumuman akan dibuka pada: ${formattedDate}. 
                                Waktu tersisa: ${newDays} hari, ${newHours} jam, ${newMinutes} menit, ${newSeconds} detik.
                            `;
                        }
                    }, 1000);

                    return; // Tidak tampilkan data jika tanggal belum dibuka
                }

                const status = row[6]; // Status ada di kolom G
                const isAccepted = status === 'Diterima';
                const rowClass = isAccepted ? 'accepted' : 'rejected';
                const button = isAccepted ? `<button class="btn-print" onclick="generateSuratDiterima({
                    nama: '${row[0]}',
                    asalSekolah: '${row[1]}', // Kolom baru
                    nisn: '${row[2]}',
                    tanggalLahir: '${row[3]}',
                    jenisKelamin: '${row[4]}',
                    namaIbu: '${row[5]}',
                    nomorUrut: ${index + 1}
                })"><i class="fas fa-print"></i> Cetak</button>` : '';

                const tableRow = `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${row[0]}</td>
                        <td>${row[1]}</td> <!-- Kolom baru -->
                        <td>${row[2]}</td>
                        <td>${row[3]}</td>
                        <td>${row[4]}</td>
                        <td>${row[5]}</td>
                        <td class="status">${status}</td>
                        <td>${formattedDate}</td>
                        <td>${button}</td>
                    </tr>
                `;
                container.innerHTML += tableRow;
            });

            if (!hasOpenDate) {
                warningMessage.innerHTML = '';
            }
        }

        // Fungsi untuk pencarian
        document.getElementById('searchButton').addEventListener('click', () => {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const filteredData = allData.filter(row => row[0].toLowerCase().includes(searchTerm));
            displayData(filteredData);
        });

        // Fungsi untuk show entries
        document.getElementById('entries').addEventListener('change', (e) => {
            const entries = e.target.value === 'all' ? allData.length : parseInt(e.target.value);
            const slicedData = allData.slice(0, entries);
            displayData(slicedData);
        });

        fetchData();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="surat.js"></script>
</body>
</html>
